import React, { useState, useEffect } from 'react';
import { CheckCircle2, XCircle, ChevronRight, RotateCcw, Award, BookOpen } from 'lucide-react';

const App = () => {
  const [currentQuestion, setCurrentQuestion] = useState(0);
  const [score, setScore] = useState(0);
  const [showScore, setShowScore] = useState(false);
  const [selectedAnswer, setSelectedAnswer] = useState(null);
  const [isCorrect, setIsCorrect] = useState(null);

  // Original questions from the guide
  const questions = [
    {
      question: "In Part 1 (Entities & Attributes), how should a Primary Key be designated?",
      options: [
        "Underline the attribute name",
        "Add (PK) after the attribute name",
        "Put the attribute name in bold",
        "Use an asterisk (*) before the name"
      ],
      answer: 1,
      explanation: "According to the guide, you must mark primary keys by adding (PK) after the attribute name."
    },
    {
      question: "Which symbols are used to represent a Multivalued Attribute?",
      options: [
        "(Parentheses)",
        "[Square Brackets]",
        "{Curly Braces}",
        "<Angle Brackets>"
      ],
      answer: 2,
      explanation: "Multivalued attributes are shown with {curly braces} around the entire attribute name."
    },
    {
      question: "How are the components of a Composite Attribute represented?",
      options: [
        "Listed in {curly braces}",
        "Indented on the next line",
        "Listed in (parentheses) after the main attribute",
        "Separated by a colon (:)"
      ],
      answer: 2,
      explanation: "Composite attributes are shown with the main name followed by components in (regular parentheses)."
    },
    {
      question: "In Part 2 (Supertype/Subtype), what symbol is used to list the subtypes under a supertype?",
      options: [
        "A simple dash (-)",
        "The symbol ⊳",
        "A bullet point (•)",
        "An arrow (→)"
      ],
      answer: 1,
      explanation: "The guide uses the '⊳' symbol to designate subtypes (e.g., ⊳ SUBTYPE_NAME)."
    },
    {
      question: "What must be included in the Part 3 Relationship description?",
      options: [
        "Only the entity names and the verb",
        "Entities, verb, and Cardinalities (Min, Max)",
        "The primary keys of both entities",
        "The names of the foreign keys"
      ],
      answer: 1,
      explanation: "A complete relationship includes entity names, the relationship name/verb, and the minimum and maximum cardinalities for both sides."
    },
    {
      question: "Where should 'Key Assumptions' be documented in the standardized format?",
      options: [
        "PART 1",
        "PART 3",
        "PART 5",
        "In the Relationship description"
      ],
      answer: 2,
      explanation: "Key Assumptions are formally placed in PART 5 of the ERD text representation."
    },
    {
      question: "True or False: Associative Entities are required in a Conceptual ERD (PART 4).",
      options: [
        "True",
        "False"
      ],
      answer: 1,
      explanation: "The guide states that associative entities are 'not needed in conceptual ERD'."
    }
  ];

  const handleAnswerClick = (index) => {
    if (selectedAnswer !== null) return;
    setSelectedAnswer(index);
    const correct = index === questions[currentQuestion].answer;
    setIsCorrect(correct);
    if (correct) setScore(score + 1);
  };

  const nextQuestion = () => {
    setSelectedAnswer(null);
    setIsCorrect(null);
    if (currentQuestion + 1 < questions.length) {
      setCurrentQuestion(currentQuestion + 1);
    } else {
      setShowScore(true);
    }
  };

  const resetQuiz = () => {
    setCurrentQuestion(0);
    setScore(0);
    setShowScore(false);
    setSelectedAnswer(null);
    setIsCorrect(null);
  };

  const progressPercentage = ((currentQuestion + 1) / questions.length) * 100;

  // University Brand Colors
  const maroon = "#7A0019";
  const gold = "#FFCC33";

  return (
    <div className="min-h-screen bg-gray-50 flex flex-col items-center py-12 px-4 font-sans">
      {/* Brand Header */}
      <div className="max-w-2xl w-full mb-8 text-center">
        <div 
          className="inline-block px-4 py-1 rounded-full text-xs font-bold tracking-widest uppercase mb-3"
          style={{ backgroundColor: gold, color: maroon }}
        >
          University of Maroon & Gold
        </div>
        <h1 className="text-3xl font-black text-gray-900 mb-2 tracking-tight">
          IDSc 3103 ERD Format Quiz
        </h1>
        <p className="text-gray-600 font-medium">Standardized Semantic Format Mastery</p>
      </div>

      <div className="max-w-2xl w-full bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-100">
        {!showScore ? (
          <>
            {/* Progress Bar */}
            <div className="h-2 w-full bg-gray-100">
              <div 
                className="h-full transition-all duration-500 ease-out"
                style={{ width: `${progressPercentage}%`, backgroundColor: maroon }}
              />
            </div>

            <div className="p-8">
              <div className="flex justify-between items-center mb-6">
                <span className="text-sm font-bold text-gray-400 uppercase tracking-wider">
                  Question {currentQuestion + 1} of {questions.length}
                </span>
                <span className="flex items-center gap-1 text-sm font-medium text-gray-500">
                  <BookOpen size={16} /> Guide Review
                </span>
              </div>

              <h2 className="text-xl font-bold text-gray-800 mb-8 leading-relaxed">
                {questions[currentQuestion].question}
              </h2>

              <div className="space-y-3">
                {questions[currentQuestion].options.map((option, index) => {
                  let buttonStyle = "border-gray-200 hover:border-maroon/30 hover:bg-gray-50";
                  let icon = null;

                  if (selectedAnswer !== null) {
                    if (index === questions[currentQuestion].answer) {
                      buttonStyle = "border-green-500 bg-green-50 text-green-700";
                      icon = <CheckCircle2 className="text-green-500" size={20} />;
                    } else if (index === selectedAnswer) {
                      buttonStyle = "border-red-500 bg-red-50 text-red-700";
                      icon = <XCircle className="text-red-500" size={20} />;
                    } else {
                      buttonStyle = "border-gray-100 opacity-50";
                    }
                  }

                  return (
                    <button
                      key={index}
                      onClick={() => handleAnswerClick(index)}
                      disabled={selectedAnswer !== null}
                      className={`w-full p-4 text-left rounded-xl border-2 transition-all duration-200 flex justify-between items-center font-medium ${buttonStyle}`}
                    >
                      <span>{option}</span>
                      {icon}
                    </button>
                  );
                })}
              </div>

              {selectedAnswer !== null && (
                <div className="mt-8 animate-in fade-in slide-in-from-bottom-4 duration-300">
                  <div className={`p-4 rounded-xl mb-6 border ${isCorrect ? 'bg-green-50 border-green-100' : 'bg-red-50 border-red-100'}`}>
                    <p className={`text-sm leading-relaxed ${isCorrect ? 'text-green-800' : 'text-red-800'}`}>
                      <span className="font-bold uppercase mr-2">{isCorrect ? 'Correct!' : 'Incorrect'}</span>
                      {questions[currentQuestion].explanation}
                    </p>
                  </div>
                  
                  <button
                    onClick={nextQuestion}
                    style={{ backgroundColor: maroon }}
                    className="w-full text-white py-4 rounded-xl font-bold flex items-center justify-center gap-2 hover:opacity-90 transition-all shadow-lg shadow-maroon/20"
                  >
                    {currentQuestion + 1 === questions.length ? "Finish Quiz" : "Next Question"}
                    <ChevronRight size={20} />
                  </button>
                </div>
              )}
            </div>
          </>
        ) : (
          <div className="p-12 text-center">
            <div 
              className="w-24 h-24 rounded-full flex items-center justify-center mx-auto mb-6 shadow-inner"
              style={{ backgroundColor: `${maroon}15` }}
            >
              <Award size={48} style={{ color: maroon }} />
            </div>
            
            <h2 className="text-3xl font-black text-gray-900 mb-2">Quiz Complete!</h2>
            <p className="text-gray-500 mb-8 font-medium">Your score on the IDSc 3103 Guide:</p>
            
            <div className="bg-gray-50 rounded-3xl p-8 mb-10 border border-gray-100">
              <div className="text-6xl font-black mb-2" style={{ color: maroon }}>
                {Math.round((score / questions.length) * 100)}%
              </div>
              <p className="text-gray-600 font-bold uppercase tracking-widest text-sm">
                {score} / {questions.length} Correct
              </p>
            </div>

            <div className="grid grid-cols-2 gap-4">
              <button
                onClick={resetQuiz}
                className="flex items-center justify-center gap-2 border-2 border-gray-200 text-gray-600 py-4 rounded-xl font-bold hover:bg-gray-50 transition-all"
              >
                <RotateCcw size={20} />
                Try Again
              </button>
              <button
                onClick={() => window.print()}
                style={{ backgroundColor: gold, color: maroon }}
                className="flex items-center justify-center gap-2 py-4 rounded-xl font-bold hover:opacity-90 transition-all shadow-md"
              >
                Save Results
              </button>
            </div>
          </div>
        )}
      </div>

      <footer className="mt-12 text-gray-400 text-sm flex flex-col items-center gap-2">
        <p className="font-medium">IDSc 3103: Information Systems for Business Processes</p>
        <div className="flex gap-4">
          <div className="w-8 h-1 rounded-full" style={{ backgroundColor: maroon }}></div>
          <div className="w-8 h-1 rounded-full" style={{ backgroundColor: gold }}></div>
        </div>
      </footer>
    </div>
  );
};

export default App;
